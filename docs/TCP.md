# TCP

[[L4-트랜스포트]] [[프로토콜]]이다.

[[TCP]]는 안정적인 전송이 목표이다. - [[신뢰성]]. 
연결 지향형 프로토콜로 연결을 수립한다. 목적지에 [[패킷]]이 도착했는지 확인하는 점이 특징. - [[3-way 핸드셰이크]] - 그러므로 긴 데이터 전송에 적합하다. 
[[윈도 사이즈]] 설정으로 [[플로우 컨트롤]]=속도 제어를 할 수 있다. 
대부분 어플리케이션에서 사용한다. 

## TCP 헤더

![TCP 헤더 구조도](../attachments/2022-09-19-15-49-17.png)

TCP 통신에서 붙는 [[헤더]].
대부분 헤더 크기는 20바이트다. 
헤더 첫 줄에서는 소스 [[포트]]와 목적지 포트를 확인할 수 있다. 

2, 3번 줄의 시퀀스 넘버=**SEQ**와 억널리지먼트 넘버acknowledgement nubmer=**ACK**로 통신이 문제 없는지 [[지속]]적으로 체크한다. 
유사 [[세션]]을 맺는 값, 혹은 패킷 번호로 여길 수 있다. 

### seq, ack의 통신 방법
1. 보내는 쪽이 임의 숫자로 자신의 seq를 생성
2. 데이터 송신후 자신의 seq 값에 보낸 데이터의 양만큼의 숫자를 증가시킴
3. 받는 쪽에서 전송 받은 seq와 데이터 양을 확인하고 ack 값을 계산해 응답으로 보냄
4. ack는 전송 받은 데이터의 양을 표시

4번 줄의 offset은 헤더의 길이가 담겨있다. 4를 곱해주면 된다. 
4-2 reserved는 6비트 크기이고 사용 안 한다. 

4-3 TCP 플래그는 6비트로 6개 플래그가 있다.
- U-URG - 긴급한 데이터가 있으면 1로 세팅
- A-ACK - 데이터의 수신 확인
- P-PSH - 보내는 데이터를 [[버퍼]]에 저장하지 않고 바로 전달
- R-RST - 연결이 비정상일 경우 연결 재수립 요청
- S-SYN - 연결 수립할 때 사용
- F-FIN - 연결 종료할 때 사용

![핸드셰이크에서 플래그의 사용](../attachments/2022-09-19-16-02-24.png)

위 그림에서 볼 수 있듯 서로의 [[포트]]가 연결된 상태, [[세션]]의 수립 상태를 established라고 한다. 
[[3-way 핸드셰이크]]로 연결을 수립하고 4-way 핸드셰이크로 연결을 종료한다. 4-way 핸드셰이크로 통신을 끊는 것이 정상 종료이다. 

![SYN 플래그가 올라가 있는 예](../attachments/2022-09-19-16-15-05.png)

SYN 플래그가 올라가 있는 예.
플래그를 올리고 내리는 것으로 신호를 주고 받으면서 통신 상태를 확인한다. 

![established된 포트들의 내역](../attachments/2022-09-19-16-19-40.png)
프롬프트에서 established된 포트들의 내역 확인하기(netstat -an으로 확인 가능)

## 참조
[[TCP-IP]], [[TCP와 UDP]]

[//begin]: # "Autogenerated link references for markdown compatibility"
[L4-트랜스포트]: L4-트랜스포트.md "L4-트랜스포트"
[프로토콜]: 프로토콜.md "프로토콜"
[TCP]: TCP.md "TCP"
[패킷]: 패킷.md "패킷"
[3-way 핸드셰이크]: <3-way 핸드셰이크.md> "3-way 핸드셰이크"
[플로우 컨트롤]: <플로우 컨트롤.md> "플로우 컨트롤"
[헤더]: 헤더.md "헤더"
[포트]: 포트.md "포트"
[세션]: 세션.md "세션"
[TCP-IP]: TCP-IP.md "TCP-IP"
[TCP와 UDP]: <TCP와 UDP.md> "TPC와 UDP"
[//end]: # "Autogenerated link references"
[//begin]: # "Autogenerated link references for markdown compatibility"
[L4-트랜스포트]: L4-트랜스포트.md "L4-트랜스포트"
[프로토콜]: 프로토콜.md "프로토콜"
[TCP]: TCP.md "TCP"
[패킷]: 패킷.md "패킷"
[3-way 핸드셰이크]: <3-way 핸드셰이크.md> "3-way 핸드셰이크"
[플로우 컨트롤]: <플로우 컨트롤.md> "플로우 컨트롤"
[헤더]: 헤더.md "헤더"
[포트]: 포트.md "포트"
[세션]: 세션.md "세션"
[포트]: 포트.md "포트"
[세션]: 세션.md "세션"
[3-way 핸드셰이크]: <3-way 핸드셰이크.md> "3-way 핸드셰이크"
[TCP-IP]: TCP-IP.md "TCP-IP"
[TCP와 UDP]: <TCP와 UDP.md> "TPC와 UDP"
[//end]: # "Autogenerated link references"